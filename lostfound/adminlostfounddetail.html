<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Item Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; font-family: Roboto; }

  body {
    background: #f5f5f5;
    padding: 30px;
  }

  .box {
    background: white;
    max-width: 850px;
    margin: auto;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  }

  .image-box {
    width: 100%;
    height: 380px;
    background: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    margin-bottom: 20px;
    color: #555;
  }

  .image-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
  }

  h2 {
    margin-bottom: 15px;
  }

  p {
    margin: 6px 0;
  }

  .section {
    margin-top: 20px;
    padding: 15px;
    background: #f1f3f4;
    border-radius: 8px;
  }

  .danger {
    margin-top: 25px;
    background: #c0392b;
    color: white;
    border: none;
    padding: 12px;
    width: 100%;
    border-radius: 8px;
    cursor: pointer;
  }

  .danger:hover {
    background: #a93226;
  }

  .back {
    margin-top: 10px;
    background: #333;
    color: white;
    border: none;
    padding: 10px;
    width: 100%;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>

<body>

<div class="box">

  <div class="image-box" id="imageBox">
    No image available
  </div>

  <h2 id="itemName"></h2>

  <p><b>Item Type:</b> <span id="itemType"></span></p>
  <p id="locationField"></p>

  <p><b>Description:</b></p>
  <p id="description"></p>

  <div class="section">
    <h3>ðŸ“Œ Reporter Details</h3>
    <p><b>Name:</b> <span id="rName"></span></p>
    <p><b>Phone:</b> <span id="rPhone"></span></p>
    <p><b>Branch:</b> <span id="rBranch"></span></p>
    <p><b>Hostel:</b> <span id="rHostel"></span></p>
    <p><b>Room No:</b> <span id="rRoom"></span></p>
  </div>

  <button class="danger" id="deleteBtn">Delete Item</button>
  <button class="back" onclick="history.back()">â¬… Back</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  deleteDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= PARAMS ================= */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");
const type = params.get("type"); // lost | found

if (!id || !type) {
  alert("Invalid request");
  throw new Error("Missing params");
}

const collectionName = type === "lost" ? "lostItems" : "foundItems";

/* ================= FETCH ITEM ================= */
const itemSnap = await getDoc(doc(db, collectionName, id));
if (!itemSnap.exists()) {
  alert("Item not found");
  throw new Error("Item not found");
}

const item = itemSnap.data();

/* ================= IMAGE ================= */
const imageBox = document.getElementById("imageBox");
if (item.imageURL) {
  imageBox.innerHTML = `<img src="${item.imageURL}">`;
}

/* ================= ITEM DETAILS ================= */
document.getElementById("itemName").innerText = item.itemName;
document.getElementById("itemType").innerText =
  type === "lost" ? "Lost Item" : "Found Item";

document.getElementById("description").innerText =
  item.description || "";

document.getElementById("locationField").innerHTML =
  type === "lost"
    ? `<b>Last Seen:</b> ${item.lastSeen}`
    : `<b>Place Found:</b> ${item.placeFound}`;

/* ================= FETCH REPORTER ================= */
if (item.reporterId) {
  const userSnap = await getDoc(doc(db, "users", item.reporterId));
  if (userSnap.exists()) {
    const u = userSnap.data();
    document.getElementById("rName").innerText = u.name || "N/A";
    document.getElementById("rPhone").innerText = u.phone || "N/A";
    document.getElementById("rBranch").innerText = u.branch || "N/A";
    document.getElementById("rHostel").innerText = u.hostel || "N/A";
    document.getElementById("rRoom").innerText = u.room || "N/A";
  }
}

/* ================= DELETE ================= */
document.getElementById("deleteBtn").onclick = async () => {
  if (!confirm("This will permanently delete the item. Continue?")) return;

  await deleteDoc(doc(db, collectionName, id));
  alert("âœ… Item deleted successfully");
  window.location.href = "admin-lost-found.html";
};
</script>

</body>
</html>
