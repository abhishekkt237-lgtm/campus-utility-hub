<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Lost & Found</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; font-family: Roboto; }

  body {
    background: #f5f5f5;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 30px;
  }

  .section {
    margin-bottom: 45px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
  }

  .card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .card:hover {
    transform: scale(1.02);
  }

  .image-box {
    height: 180px;
    background: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #555;
    font-size: 14px;
  }

  .image-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .content {
    padding: 15px;
  }

  .content h3 {
    margin: 0 0 8px;
  }

  .content p {
    font-size: 14px;
    margin: 4px 0;
  }

  .delete-btn {
    margin-top: 10px;
    width: 100%;
    padding: 8px;
    background: #c0392b;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  .delete-btn:hover {
    background: #a93226;
  }
</style>
</head>

<body>

<h1>ðŸ›  Admin â€“ Lost & Found Control Panel</h1>

<div class="section">
  <h2>ðŸ”´ Lost Items</h2>
  <div class="grid" id="lostGrid"></div>
</div>

<div class="section">
  <h2>ðŸŸ¢ Found Items</h2>
  <div class="grid" id="foundGrid"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

import {
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* ================= AUTH CHECK ================= */
onAuthStateChanged(auth, user => {
  if (!user) {
    alert("Admin login required");
    window.location.href = "login.html";
  }
});

/* ================= CREATE CARD ================= */
function createCard(data, id, type) {
  const card = document.createElement("div");
  card.className = "card";

  card.onclick = () => {
    window.location.href =
      `adminlostfounddetail.html?type=${type}&id=${id}`;
  };

  const imageBox = document.createElement("div");
  imageBox.className = "image-box";

  if (data.imageURL) {
    const img = document.createElement("img");
    img.src = data.imageURL;
    imageBox.appendChild(img);
  } else {
    imageBox.innerText = "No image available";
  }

  const content = document.createElement("div");
  content.className = "content";

  content.innerHTML = `
    <h3>${data.itemName}</h3>
    <p><b>${type === "lost" ? "Last Seen" : "Found At"}:</b>
       ${type === "lost" ? data.lastSeen : data.placeFound}</p>
    <p>${data.description}</p>
  `;

  const delBtn = document.createElement("button");
  delBtn.className = "delete-btn";
  delBtn.innerText = "Delete";

  delBtn.onclick = async (e) => {
    e.stopPropagation();
    if (!confirm("Delete this item permanently?")) return;

    await deleteDoc(
      doc(db, type === "lost" ? "lostItems" : "foundItems", id)
    );

    alert("âœ… Item deleted");
    loadLostItems();
    loadFoundItems();
  };

  content.appendChild(delBtn);
  card.appendChild(imageBox);
  card.appendChild(content);

  return card;
}

/* ================= LOAD LOST ================= */
async function loadLostItems() {
  const grid = document.getElementById("lostGrid");
  grid.innerHTML = "";

  const snap = await getDocs(collection(db, "lostItems"));
  snap.forEach(d =>
    grid.appendChild(createCard(d.data(), d.id, "lost"))
  );
}

/* ================= LOAD FOUND ================= */
async function loadFoundItems() {
  const grid = document.getElementById("foundGrid");
  grid.innerHTML = "";

  const snap = await getDocs(collection(db, "foundItems"));
  snap.forEach(d =>
    grid.appendChild(createCard(d.data(), d.id, "found"))
  );
}

/* ================= INIT ================= */
loadLostItems();
loadFoundItems();
</script>

</body>
</html>
