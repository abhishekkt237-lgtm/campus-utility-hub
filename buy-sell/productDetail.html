<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Details</title>
<style>
  body { 
    font-family: Roboto, sans-serif;
     background:#d5d3cc; 
     padding:30px;
     }
  .box {
     background:white; 
     padding:30px;
      margin:auto;
       border-radius:10px; 
       box-shadow:0 5px 15px rgba(0,0,0,0.2); 
       display: flex;
        font-size: 18px;
         min-width: 700px;
         max-width: 1200px;
        }
  img {
     width:450px; 
     border-radius:10px;
      margin:0 50px 0 10px;
       box-shadow:0 5px 15px rgba(0,0,0,0.2);  
    }
  h2, h3 {
     margin-top:15px; 
     font-size: 30px;
     }
  .product-info p, .seller p
   
  { margin:7px 0;
  }

  .seller { 
    margin-top:20px;
     background:#eef3e0; 
     padding:15px;
      border-radius:8px;
       box-shadow:0 5px 15px rgba(0,0,0,0.2); 
     }
  .chat-btn {
     padding:10px 15px;
      background:#543002;
       color:white;
        border:none;
         border-radius:6px;
          cursor:pointer; 
  margin-top:10px;
   box-shadow:0 5px 15px rgba(0,0,0,0.2); 
   font-size: 16px;
   transition: all 0.15s;
 }
 .chat-btn:hover {
  background-color: #7e5e33;
 }
  .info {
    min-width: 50%;
  }
  .product-info {
    background-color:#f7f2db;
    padding: 10px;
    border-radius: 8px;
     box-shadow:0 5px 15px rgba(0,0,0,0.2); 
  }
</style>
</head>
<body>
<div class="box">
  <img id="productImage" src="" alt="Product Image">
  <div class="info">
  <h2 id="productName"></h2>
  <div class="product-info">
    <p><b>Price:</b> â‚¹<span id="productPrice"></span></p>
    <p><b>Category:</b> <span id="productCategory"></span></p>
    <p><b>Quantity:</b> <span id="productQuantity"></span></p>
    <p><b>Description:</b></p>
    <p id="productDescription"></p>
  </div>

  <div class="seller">
    <h3>Seller Info</h3>
    <p><b>Name:</b> <span id="sellerName"></span></p>
    <p><b>Phone:</b> <span id="sellerPhone"></span></p>
    <p><b>Branch:</b> <span id="sellerBranch"></span></p>
    <p><b>Hostel:</b> <span id="sellerHostel"></span></p>
    <p><b>Room No.:</b> <span id="sellerRoom"></span></p>

    <button class="chat-btn" id="chatBtn">Chat with Seller</button>
  </div></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Get productId from URL
const params = new URLSearchParams(window.location.search);
const productId = params.get("productId");
if(!productId){ alert("Product not specified"); throw new Error("No productId"); }

// Fetch product
const productSnap = await getDoc(doc(db, "products", productId));
if(!productSnap.exists()){ alert("Product not found"); throw new Error("Product not found"); }
const product = productSnap.data();

// Populate product info
document.getElementById("productImage").src = product.imageURL || "";
document.getElementById("productName").innerText = product.name || "";
document.getElementById("productPrice").innerText = product.price || "";
document.getElementById("productCategory").innerText = product.category || "";
document.getElementById("productQuantity").innerText = product.quantity || "";
document.getElementById("productDescription").innerText = product.description || "";

// Fetch seller info
const sellerSnap = await getDoc(doc(db, "users", product.sellerId));
if(sellerSnap.exists()){
  const seller = sellerSnap.data();
  document.getElementById("sellerName").innerText = seller.fullName || "";
  document.getElementById("sellerPhone").innerText = seller.phone || "";
  document.getElementById("sellerBranch").innerText = seller.branch || "";
  document.getElementById("sellerHostel").innerText = seller.hostel || "";
  document.getElementById("sellerRoom").innerText = seller.room || "";

  document.getElementById("chatBtn").onclick = () => {
    if(seller.phone) window.open(`https://wa.me/${seller.phone}`, "_blank");
    else alert("Phone number not available");
  }
} else {
  alert("Seller info not found");
}
</script>
</body>
</html>
