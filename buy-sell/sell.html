<!DOCTYPE html>
<html>
<head>
  <title>Sell Product</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; font-family: Roboto; }
    body {
      background: linear-gradient(135deg,#efe6c2,#fbf8f6,#efe6c2);
      justify-content:center;
      align-items:center;
      min-height:100vh;
    }
    .box {
      background:#e9f4d1;
      padding:20px 30px 0 30px;
      width:700px;
      border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,.3);
      margin: auto;
    }
    h2 { 
      text-align:center;
      margin: 0 0 10px 0;
       font-size: 25px;
       }
    label {
       font-weight:600;
       margin-top:10px;
       display:block; }
    input, select, textarea {
      width:100%;
      padding:10px;
      margin-top:5px;
      border-radius:6px;
      border:1px solid #aaa;
    }
    textarea { resize:none; height:90px; }
    button {
      width:45%;
      padding:12px;
      margin-top:20px;
      background:#543002;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
      margin-left: 20px;
    }
    .mine {
    background:#333;
    color:white;
    padding:12px 15px;
    margin-bottom:20px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    margin-left: 20px;
    }
  </style>
</head>

<body>

<div class="box">
  <h2>Add Product</h2>

  <form id="form">
    <label>Product Name</label>
    <input id="name" required>

    <label>Price (₹)</label>
    <input id="price" type="number" required>

    <label>Category</label>
    <select id="category" required>
      <option value="">Select</option>
      <option>Electronics</option>
      <option>Books</option>
      <option>Clothing</option>
      <option>Cycles</option>
      <option>Sports</option>
      <option>Miscellaneous</option>
    </select>

    <label>Quantity</label>
    <input id="quantity" type="number" required>

    <label>Product Image</label>
    <input id="image" type="file" accept="image/*" required>

    <label>Description</label>
    <textarea id="desc" required></textarea>

    <button>Submit</button>
    <button class="mine" id="myProductsBtn">
  My Products
</button>
  </form>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
    authDomain: "campus-utility-hub-iitism.firebaseapp.com",
    projectId: "campus-utility-hub-iitism"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // ✅ ELEMENTS
  const form = document.getElementById("form");
  const nameInput = document.getElementById("name");
  const priceInput = document.getElementById("price");
  const categoryInput = document.getElementById("category");
  const quantityInput = document.getElementById("quantity");
  const imageInput = document.getElementById("image");
  const descInput = document.getElementById("desc");

  let currentUser = null;

  // ✅ AUTH READY
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
    } else {
      alert("Please login first");
    }
  });

  // ✅ CLOUDINARY
  async function uploadImage(file) {
    const fd = new FormData();
    fd.append("file", file);
    fd.append("upload_preset", "noticeboard_upload");

    const res = await fetch(
      "https://api.cloudinary.com/v1_1/dfclsa1oc/auto/upload",
      { method: "POST", body: fd }
    );

    const data = await res.json();
    return data.secure_url;
  }

  // ✅ SUBMIT
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!currentUser) {
      alert("Auth not ready. Please wait 1 second.");
      return;
    }

    if (!imageInput.files[0]) {
      alert("Select image");
      return;
    }

    try {
      const imageURL = await uploadImage(imageInput.files[0]);

      await addDoc(collection(db, "products"), {
        name: nameInput.value,
        price: Number(priceInput.value),
        category: categoryInput.value,
        quantity: Number(quantityInput.value),
        description: descInput.value,
        imageURL,
        sellerId: currentUser.uid,
        createdAt: serverTimestamp()
      });

      alert("✅ Product added successfully");
      form.reset();
    } catch (err) {
      console.error(err);
      alert("❌ Upload failed");
    }
  });
  document.getElementById("myProductsBtn").onclick = () => {
  window.location.href = "myProducts.html"; // Link to your My Products page
};

</script>

</body>
</html>
