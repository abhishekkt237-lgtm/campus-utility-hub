<!DOCTYPE html>
<html>
<head>
  <title>My Products</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body { font-family: Roboto; background:#f5f5f5; padding:20px; }
    h2 { text-align:center; }
    #myProducts { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px; margin-top:20px; }
    .productCard { background:white; padding:15px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); position:relative; }
    .productCard img { width:100%; height:150px; object-fit:cover; border-radius:6px; }
    .productCard h3 { margin:10px 0 5px 0; }
    .productCard button { position:absolute; top:10px; right:10px; background:#ff4d4d; border:none; color:white; padding:5px 10px; border-radius:5px; cursor:pointer; }
  </style>
</head>
<body>
<h2>My Uploaded Products</h2>
<div id="myProducts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, query, where, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const myProductsDiv = document.getElementById("myProducts");

onAuthStateChanged(auth, async (user) => {
  if (!user) { alert("Please login"); return; }

  const q = query(collection(db, "products"), where("sellerId", "==", user.uid));
  const snapshot = await getDocs(q);

  myProductsDiv.innerHTML = "";

  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const card = document.createElement("div");
    card.className = "productCard";

    card.innerHTML = `
      <img src="${data.imageURL}" alt="Product">
      <h3>${data.name}</h3>
      <p>â‚¹${data.price}</p>
      <p>${data.category}</p>
      <button>Delete</button>
    `;

    const deleteBtn = card.querySelector("button");
    deleteBtn.onclick = async () => {
      if (confirm("Are you sure to delete this product?")) {
        await deleteDoc(doc(db, "products", docSnap.id));
        alert("Product deleted!");
        card.remove();
      }
    };

    myProductsDiv.appendChild(card);
  });
});
</script>
</body>
</html>
