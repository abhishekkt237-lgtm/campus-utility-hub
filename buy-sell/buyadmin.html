<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin â€“ Manage Products</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Roboto', sans-serif;
  margin:0;
  background:#f2f2f2;
}

header {
  background:#222;
  color:white;
  padding:15px;
  text-align:center;
}

#productGrid {
  display:grid;
  grid-template-columns: repeat(auto-fill,minmax(250px,1fr));
  gap:20px;
  padding:20px;
}

.productTile {
  background:#fff;
  border-radius:12px;
  padding:15px;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
  cursor:pointer;
  transition:0.2s;
}

.productTile:hover {
  transform: scale(1.03);
}

.productTile img {
  width:100%;
  height:150px;
  object-fit:cover;
  border-radius:8px;
}

.productTile h3 {
  margin:10px 0 5px;
}

.productTile p {
  margin:4px 0;
  font-size:14px;
}

.deleteBtn {
  margin-top:10px;
  width:100%;
  padding:10px;
  background:#c62828;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.deleteBtn:hover {
  background:#b71c1c;
}
</style>
</head>

<body>

<header>
  <h1>Admin Panel â€“ Manage Products</h1>
</header>

<div id="productGrid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  getDocs, 
  deleteDoc, 
  doc 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const productGrid = document.getElementById("productGrid");

async function loadProducts() {
  productGrid.innerHTML = "";
  const snapshot = await getDocs(collection(db, "products"));

  snapshot.forEach(docSnap => {
    const data = docSnap.data();

    const tile = document.createElement("div");
    tile.className = "productTile";

    // ðŸ‘‰ CLICK TILE â†’ OPEN PRODUCT DETAILS PAGE
    tile.onclick = () => {
      window.location.href = `productDetail.html?productId=${docSnap.id}`;
    };

    tile.innerHTML = `
      <img src="${data.imageURL}">
      <h3>${data.name}</h3>
      <p><strong>â‚¹${data.price}</strong></p>
      <p>${data.category}</p>
      <p>Quantity: ${data.quantity}</p>
      <button class="deleteBtn">Delete Product</button>
    `;

    // âŒ DELETE (STOP CLICK PROPAGATION)
    tile.querySelector(".deleteBtn").onclick = async (e) => {
      e.stopPropagation(); // VERY IMPORTANT

      const confirmDelete = confirm("Are you sure you want to delete this product?");
      if(!confirmDelete) return;

      await deleteDoc(doc(db, "products", docSnap.id));
      alert("Product deleted successfully");
      loadProducts();
    };

    productGrid.appendChild(tile);
  });
}

loadProducts();
</script>

</body>
</html>
