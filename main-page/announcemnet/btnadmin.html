<!DOCTYPE html>
<html>
  <head>
    <title>
      Edit noticeboard
    </title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      body {
       background: linear-gradient(90deg, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.55) , rgba(0, 0, 0, 0.75));
        display: flex;

       }

      .announcements {
        background-color: rgb(255, 255, 255);
        margin: 30px 0px 20px 0;
        min-height: 660px;
        min-width: 730px;
      }
      .subannouncement {
         background-image: url(logo.png);
        background-size: 300px;
        background-repeat: no-repeat;
        background-position: 235px 175px;
        min-height: 600px;
        opacity: 0.2;
      }
      .subnotice {
         background-image: url(logo.png);
        background-size: 300px;
        background-repeat: no-repeat;
        background-position: 245px 175px;
        min-height: 600px;
        opacity: 0.2;

      }
      .notice {
        min-width: 726px;
         background-color: rgb(255, 255, 255);
        margin: 30px 0px 20px 80px;
        min-height: 660px;
      }
      .announcementhead {
        z-index: 1;
        position: fixed;
        background-color: rgb(61, 61, 61);
        color: white;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-weight: 600;
        font-size: 40px;
        text-align: center;
        padding: 0 180px;
        margin: 40px 0 0 0;
         box-shadow: 0px 5px 5px rgba(0, 0, 0, 0.4);
      }
      .noticehead {
        z-index: 1;
        position: fixed;
        background-color: rgb(61, 61, 61);
        color: white;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-weight: 600;
        font-size: 40px;
        text-align: center;
        padding: 0 290px;
        margin: 40px 0 0 800px;
        box-shadow: 0px 5px 5px rgba(0, 0, 0, 0.4);
      } 
      .ab {
        height:50px;
        width:50px;
        position:fixed;
        z-index: 1;
        margin: 626px 10px 10px 666px;
        border-radius:30px;
        border-color:rgba(61, 61, 61, 0.7);
        border-style: solid;
        border-width: 3px;
        font-size: 40px;
        font-weight: bold;
        color:rgba(61, 61, 61, 0.9);
        cursor: pointer;
        transition: all 0.15s;
      }
      .ab:hover {
         background-color:rgba(61, 61, 61, 0.9) ;
        border-color: rgba(61, 61, 61, 0);
        color: white;
        width: 56px;
        height: 56px;
        border-radius: 28px;
         margin: 623px 10px 10px 663px;
      }
      .nb {
        height:50px;
        width:50px;
        position:fixed;
        z-index: 1;
        margin: 626px 10px 10px 1470px;
        border-radius:30px;
        border-color:rgba(61, 61, 61, 0.7);
        border-style: solid;
        border-width: 3px;
        font-size: 40px;
        font-weight: bold;
        color:rgba(61, 61, 61, 0.9);
        cursor: pointer;
        transition: all 0.15s;
      }
      .nb:hover {
        background-color:rgba(61, 61, 61, 0.9) ;
        border-color: rgba(61, 61, 61, 0);
        color: white;
        width: 56px;
        height: 56px;
        border-radius: 28px;
        margin: 623px 0 0 1467px;
      }

    </style>
  </head>
  <body>
    <div class="announcements">
      <div class="subannouncement">

      </div>
     
    </div>
    <div class="notice">
      <div class="subnotice">

      </div>
 
    </div>
    <div class="announcementhead">
      ANNOUNCEMENTS
    </div>
    <div id="announcementList"></div>

    <DIV CLASS="noticehead">
      NOTICES
    </DIV>
    <div id="noticeList"></div>

   <button class="ab" onclick="openAnnouncement()">
    +
   </button>

<button class="nb" onclick="openNotice()">
  +
</button>



<!-- ANNOUNCEMENT MODAL -->
<div id="announcementModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center;">
  <div style="background:white;width:400px;padding:20px;border-radius:10px;">
    <h2>Add Announcement</h2><br>

    <label>Heading</label>
    <input type="text" id="annTitle" style="width:100%;padding:8px;"><br><br>

    <label>Upload Document</label>
    <input type="file" id="annFile"><br><br>

    <label>Expiry Date</label>
    <input type="date" id="annExpiry"><br><br>

    <button onclick="saveAnnouncement()">Save</button>
    <button onclick="closeAnnouncement()">Cancel</button>
  </div>
</div>

<!-- NOTICE MODAL -->
<div id="noticeModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center;">
  <div style="background:white;width:400px;padding:20px;border-radius:10px;">
    <h2>Add Notice</h2><br>

    <label>Heading</label>
    <input type="text" id="noticeTitle" style="width:100%;padding:8px;"><br><br>

    <label>Upload Document</label>
    <input type="file" id="noticeFile"><br><br>

    <label>Expiry Date</label>
    <input type="date" id="noticeExpiry"><br><br>

    <button onclick="saveNotice()">Save</button>
    <button onclick="closeNotice()">Cancel</button>
  </div>
</div>

  </div>
</div>

<script>
  function openAnnouncement() {
    document.getElementById("announcementModal").style.display = "flex";
  }
  function closeAnnouncement() {
    document.getElementById("announcementModal").style.display = "none";
  }

  function openNotice() {
    document.getElementById("noticeModal").style.display = "flex";
  }
  function closeNotice() {
    document.getElementById("noticeModal").style.display = "none";
  }
</script>

<script type="module">

async function uploadToCloudinary(file) {
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", "noticeboard_upload");

  const response = await fetch(
    "https://api.cloudinary.com/v1_1/dfclsa1oc/auto/upload",
    {
      method: "POST",
      body: formData
    }
  );

  const data = await response.json();
  return data.secure_url;
}


  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyAVGVP0c6e9KMdp2RmqOeGGVxr8kFsXZ7M",
  authDomain: "campus-utility-hub-iitism.firebaseapp.com",
  projectId: "campus-utility-hub-iitism",
  storageBucket: "campus-utility-hub-iitism.firebasestorage.app",
  messagingSenderId: "281851939722",
  appId: "1:281851939722:web:62f0da477d4c2a917f5673"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ðŸ”¹ SAVE ANNOUNCEMENT
 window.saveAnnouncement = async function () {
  const title = document.getElementById("annTitle").value;
  const file = document.getElementById("annFile").files[0];
  const expiry = document.getElementById("annExpiry").value;

  if (!title || !file || !expiry) {
    alert("Fill all fields");
    return;
  }

  try {
    const fileURL = await uploadToCloudinary(file);

    await addDoc(collection(db, "announcements"), {
      title: title,
      fileURL: fileURL,
      expiryDate: expiry,
      createdAt: serverTimestamp()
    });

    closeAnnouncement();
    alert("Announcement added");
    loadAnnouncements();

  } catch (error) {
    console.error(error);
    alert("Upload failed");
  }
};


  // ðŸ”¹ SAVE NOTICE
  window.saveNotice = async function () {
  const title = document.getElementById("noticeTitle").value;
  const file = document.getElementById("noticeFile").files[0];
  const expiry = document.getElementById("noticeExpiry").value;

  if (!title || !file || !expiry) {
    alert("Fill all fields");
    return;
  }

  try {
    const fileURL = await uploadToCloudinary(file);

    await addDoc(collection(db, "notices"), {
      title: title,
      fileURL: fileURL,
      expiryDate: expiry,
      createdAt: serverTimestamp()
    });

    closeNotice();
    alert("Notice added");
    loadNotices();

  } catch (error) {
    console.error(error);
    alert("Upload failed");
  }
};

  // LOAD ANNOUNCEMENTS WITH DELETE
async function loadAnnouncements() {
  const list = document.getElementById("announcementList");
  list.innerHTML = "";

  const snapshot = await getDocs(collection(db, "announcements"));

  snapshot.forEach(doc => {
    const data = doc.data();

    const item = document.createElement("div");
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center";
    item.style.padding = "12px";
    item.style.borderBottom = "1px solid #ccc";
    item.style.cursor = "pointer";
    item.style.fontWeight = "600";

    const titleDiv = document.createElement("span");
    titleDiv.textContent = data.title;
    titleDiv.style.color = "#1a0dab";
    titleDiv.onclick = () => window.open(data.fileURL, "_blank");

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "ðŸ—‘ Delete";
    deleteBtn.style.background = "red";
    deleteBtn.style.color = "white";
    deleteBtn.style.border = "none";
    deleteBtn.style.padding = "4px 8px";
    deleteBtn.style.cursor = "pointer";
    deleteBtn.onclick = async (e) => {
      e.stopPropagation(); // prevent opening the document
      if (!confirm("Are you sure you want to delete this announcement?")) return;

      try {
        // Delete Firestore entry
        await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js")
          .then(({ doc: fsDoc, deleteDoc }) => deleteDoc(fsDoc(db, "announcements", doc.id)));

        // Remove from DOM
        list.removeChild(item);

        alert("Announcement deleted successfully!");
      } catch (err) {
        console.error(err);
        alert("Delete failed");
      }
    };

    item.appendChild(titleDiv);
    item.appendChild(deleteBtn);

    list.appendChild(item);
  });
}


// LOAD NOTICES WITH DELETE
async function loadNotices() {
  const list = document.getElementById("noticeList");
  list.innerHTML = "";

  const snapshot = await getDocs(collection(db, "notices"));

  snapshot.forEach(doc => {
    const data = doc.data();

    const item = document.createElement("div");
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center";
    item.style.padding = "12px";
    item.style.borderBottom = "1px solid #ccc";
    item.style.cursor = "pointer";
    item.style.fontWeight = "600";

    const titleDiv = document.createElement("span");
    titleDiv.textContent = data.title;
    titleDiv.style.color = "#1a0dab";
    titleDiv.onclick = () => window.open(data.fileURL, "_blank");

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "ðŸ—‘ Delete";
    deleteBtn.style.background = "red";
    deleteBtn.style.color = "white";
    deleteBtn.style.border = "none";
    deleteBtn.style.padding = "4px 8px";
    deleteBtn.style.cursor = "pointer";
    deleteBtn.onclick = async (e) => {
      e.stopPropagation();
      if (!confirm("Are you sure you want to delete this notice?")) return;

      try {
        // Delete Firestore entry
        await import("https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js")
          .then(({ doc: fsDoc, deleteDoc }) => deleteDoc(fsDoc(db, "notices", doc.id)));

        // Remove from DOM
        list.removeChild(item);

        alert("Notice deleted successfully!");
      } catch (err) {
        console.error(err);
        alert("Delete failed");
      }
    };

    item.appendChild(titleDiv);
    item.appendChild(deleteBtn);

    list.appendChild(item);
  });
}

loadAnnouncements();
loadNotices();

</script>

  </body>
</html>